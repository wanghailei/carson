#!/usr/bin/env bash
set -euo pipefail

remote_name="${1:-unknown}"
remote_url="${2:-unknown}"
while read -r local_ref local_sha remote_ref remote_sha; do
	case "$remote_ref" in
		refs/heads/main|refs/heads/master)
			echo "Butler policy: direct push to ${remote_ref#refs/heads/} is blocked on remote ${remote_name} (${remote_url}). Use a pull request." >&2
			exit 1
			;;
	esac
done
